<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des T√¢ches Enseignants</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- NOUVEAU: Script pour appliquer le th√®me instantan√©ment -->
    <script>
        (function() {
            function applyTheme(theme) {
                // Applique le th√®me en ajoutant/retirant une classe sur le body.
                document.body.classList.remove('theme-dark', 'theme-vintage');
                if (theme === 'dark') {
                    document.body.classList.add('theme-dark');
                } else if (theme === 'vintage') {
                    document.body.classList.add('theme-vintage');
                }
                // 'light' est le th√®me par d√©faut, aucune classe n'est n√©cessaire.
            }
        
            // Applique le th√®me sauvegard√© d√®s que possible.
            const savedTheme = localStorage.getItem('appTheme') || 'light';
            applyTheme(savedTheme);
        })();
    </script>
</head>
<body class="theme-light"> <!-- La classe par d√©faut est ajout√©e ici -->
    <header>
        <h1>Application de Gestion des T√¢ches</h1>
        <p>Bienvenue ! S√©lectionnez une option dans la navigation pour commencer.</p>

        <!-- NOUVEAU: S√©lecteur de th√®me -->
        <div class="theme-switcher no-print">
            <button id="theme-btn-light" data-theme="light">Clair</button>
            <button id="theme-btn-dark" data-theme="dark">Sombre</button>
            <button id="theme-btn-vintage" data-theme="vintage">Vintage</button>
        </div>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <nav>
            <div class="admin-section" style="max-width: 800px; margin: auto;">
                <h2>Navigation</h2>
                <ul>
                    <!-- Liens d'authentification et informations utilisateur -->
                    {% if current_user.is_authenticated %}
                        <li>Connect√©(e) en tant que: <strong>{{ current_user.username }}</strong></li>
                        <li><a href="{{ url_for('logout') }}">D√©connexion</a></li>
                    {% else %}
                        <li><a href="{{ url_for('login') }}"><strong>Connexion</strong></a></li>
                        <li><a href="{{ url_for('register') }}"><strong>S'inscrire</strong></a></li>
                    {% endif %}

                    <hr>

                    <!-- Liens principaux de l'application -->
                    {% if current_user.is_authenticated and current_user.is_admin %}
                        <li><strong>Outils Administrateur</strong></li>
                        <li><a href="{{ url_for('page_sommaire') }}">Voir le Sommaire Global</a></li>
                        <li><a href="{{ url_for('page_administration_donnees') }}">G√©rer les donn√©es (Import, R√©assignation)</a></li>
                        <li><a href="{{ url_for('page_administration_utilisateurs') }}">G√©rer les utilisateurs</a></li>
                        <hr>
                    {% endif %}

                    <li><strong>Navigation par Champ :</strong></li>
                    <!-- Boucle pour afficher les liens vers chaque page de champ. -->
                    {% if champs %}
                        {% for champ in champs %}
                        <li>
                            <a href="{{ url_for('page_champ', champ_no=champ.champno) }}">
                                {{ champ.champno }} - {{ champ.champnom }}
                            </a>
                            {% if champ.estverrouille %}
                                <span class="locked-indicator" title="Ce champ est verrouill√©">üîí</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    {% else %}
                        <!-- Message affich√© si aucun champ n'est accessible ou trouv√© -->
                        <li>Aucun champ trouv√© ou accessible pour votre compte.</li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </main>

    <footer>
        <p>¬© {{ SCRIPT_YEAR }} Pour l'√©cole Marie-Rivier</p>
    </footer>

    <!-- NOUVEAU: Script pour g√©rer les clics et mettre √† jour le th√®me actif -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitcher = document.querySelector('.theme-switcher');
            const themeButtons = document.querySelectorAll('.theme-switcher button');
            
            function applyTheme(theme) {
                document.body.classList.remove('theme-dark', 'theme-vintage', 'theme-light');
                document.body.classList.add(`theme-${theme}`);
                
                themeButtons.forEach(btn => {
                    btn.classList.remove('active');
                });

                const activeButton = document.getElementById(`theme-btn-${theme}`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }

            function setTheme(theme) {
                localStorage.setItem('appTheme', theme);
                applyTheme(theme);
            }

            themeSwitcher.addEventListener('click', function(event) {
                if (event.target.tagName === 'BUTTON') {
                    const theme = event.target.dataset.theme;
                    setTheme(theme);
                }
            });

            // Appliquer le th√®me actif au chargement
            const savedTheme = localStorage.getItem('appTheme') || 'light';
            applyTheme(savedTheme); 
        });
    </script>
</body>
</html>