<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des T√¢ches Enseignants</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Script pour appliquer le th√®me instantan√©ment -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('appTheme') || 'light';
            document.documentElement.className = `theme-${savedTheme}`;
        })();
    </script>
</head>
<body class="theme-light">
    <header>
        <h1>Application de Gestion des T√¢ches</h1>
        <p>Bienvenue ! S√©lectionnez une option dans la navigation pour commencer.</p>

        <!-- S√©lecteur de th√®me -->
        <div class="theme-switcher no-print">
            <button id="theme-btn-light" data-theme="light" title="Activer le th√®me clair">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
                </svg>
                Clair
            </button>
            <button id="theme-btn-dark" data-theme="dark" title="Activer le th√®me sombre">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
                </svg>
                Sombre
            </button>
            <button id="theme-btn-artistic" data-theme="artistic" title="Activer le th√®me artistique">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                </svg>
                Artistique
            </button>
        </div>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <nav>
            <div class="admin-section" style="max-width: 800px; margin: auto;">
                <h2>Navigation</h2>
                <ul>
                    <!-- Liens d'authentification et informations utilisateur -->
                    {% if current_user.is_authenticated %}
                        <li>Connect√©(e) en tant que: <strong>{{ current_user.username }}</strong></li>
                        <li><a href="{{ url_for('auth.logout') }}">D√©connexion</a></li>
                    {% else %}
                        <li><a href="{{ url_for('auth.login') }}"><strong>Connexion</strong></a></li>
                        <li><a href="{{ url_for('auth.register') }}"><strong>S'inscrire</strong></a></li>
                    {% endif %}

                    <hr>

                    <!-- Liens principaux de l'application -->
                    {% if current_user.is_authenticated and current_user.is_admin %}
                        <li><strong>Outils Administrateur</strong></li>
                        <li><a href="{{ url_for('admin.page_sommaire') }}">Voir le Sommaire Global</a></li>
                        <li><a href="{{ url_for('admin.page_administration_donnees') }}">G√©rer les donn√©es (Import, R√©assignation)</a></li>
                        <li><a href="{{ url_for('admin.page_administration_utilisateurs') }}">G√©rer les utilisateurs</a></li>
                        <hr>
                    {% endif %}

                    <li><strong>Navigation par Champ :</strong></li>
                    <!-- Boucle pour afficher les liens vers chaque page de champ. -->
                    {% if champs %}
                        {% for champ in champs %}
                        <li>
                            <a href="{{ url_for('views.page_champ', champ_no=champ.champno) }}">
                                {{ champ.champno }} - {{ champ.champnom }}
                            </a>
                            {% if champ.estverrouille %}
                                <span class="locked-indicator" title="Ce champ est verrouill√©">üîí</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    {% else %}
                        <!-- Message affich√© si aucun champ n'est accessible ou trouv√© -->
                        <li>Aucun champ trouv√© ou accessible pour votre compte.</li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </main>

    <footer>
        <p>¬© ‚ìö {{ SCRIPT_YEAR }} Pour l'√©cole Marie-Rivier</p>
    </footer>

    <!-- Script pour g√©rer les clics et mettre √† jour le th√®me actif -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitcher = document.querySelector('.theme-switcher');
            if (themeSwitcher) {
                const themeButtons = themeSwitcher.querySelectorAll('button');

                /**
                 * Applique la classe de th√®me √† l'√©l√©ment racine et met √† jour l'√©tat actif des boutons.
                 * @param {string} theme - Le nom du th√®me √† appliquer.
                 */
                function applyThemeUI(theme) {
                    document.documentElement.className = `theme-${theme}`;

                    themeButtons.forEach(btn => btn.classList.remove('active'));
                    const activeButton = document.getElementById(`theme-btn-${theme}`);
                    if (activeButton) {
                        activeButton.classList.add('active');
                    }
                }

                // √âcoute les clics sur le conteneur du s√©lecteur de th√®me pour d√©l√©guer l'√©v√©nement.
                themeSwitcher.addEventListener('click', function(event) {
                    // V√©rifie si l'√©l√©ment cliqu√© est un bouton
                    if (event.target.tagName === 'BUTTON') {
                        const theme = event.target.dataset.theme;
                        localStorage.setItem('appTheme', theme);
                        applyThemeUI(theme);
                    }
                });

                // Applique le th√®me sauvegard√© au chargement DOM complet.
                const savedTheme = localStorage.getItem('appTheme') || 'light';
                applyThemeUI(savedTheme);
            }
        });
    </script>
</body>
</html>